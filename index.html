<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
	<link rel="stylesheet" type="text/css" href="style.css" />
	<script src="libs/jquery-1.8.3.min.js"></script>
	<script src="libs/json2.js"></script>
	<script src="libs/underscore-min.js"></script>
	<script src="libs/backbone-min.js"></script>
	<title>Flight Form</title>
</head>

<body>

<script type="text/javascript">

// Some regex kungfu off of StackOverflow to parse url params as dict
function getUrlParameters() {
	var map = {};
	window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) { map[key] = value; });
	return map; 
}

function readForm(form) {
	// Generate instance of the model from form data
	var flight = genFlight(form);

	// Generate view of instance to html
	var msg = new FlightView({model: flight});
	msg.render();

	console.log(msg.el);
	// alert(msg.el.innerHTML);
	document.getElementById('flights').innerHTML = msg.el.innerHTML;

	// alert("Number of passengers: "+flight.get('numPassengers')+"\n"+
	// 	"From: "+flight.get('from')+"\n"+
	// 	"To: "+flight.get('to')+"\n"+
	// 	"Departing: "+flight.get('depDate')+" "+flight.get('depTime')+"\n"+
	// 	"Returning: "+flight.get('retDate')+" "+flight.get('retTime')+"\n");
}

// Model
var FlightItem = Backbone.Model.extend({});

function genFlight(form) {
	return new FlightItem({
		from: 			form["from"],
		to: 			form["to"],
		depDate: 		form["depDate"],
		depTime: 		form["depTime"],
		retDate: 		form["retDate"],
		retTime: 		form["retTime"],
		numPassengers: 	form["numPassengers"]
	});
}


// View
var FlightView = Backbone.View.extend({
	tagName: 'li',
	id: 'flight',
	render: function() {
		var html = "<h3>Generated Flight Information:</h3><br>"+
		"<i>Number of passengers:</i> "+this.model.get('numPassengers')+"<br>"+
		"<i>From:</i> "+this.model.get('from')+"<br>"+
		"<i>To:</i> "+this.model.get('to')+"<br>"+
		"<i>Departing:</i> "+this.model.get('depDate')+" "+this.model.get('depTime')+"<br>"+
		"<i>Returning:</i> "+this.model.get('retDate')+" "+this.model.get('retTime');
		this.$el.html(html);
	}
});


</script>

<form method="GET" name="travelForm" id="travelForm" onsubmit="readForm(this)">
<h1>Travel Form</h1>
<fieldset id="inputs">
	<label>From: </label>
	<input name="from" placeholder="From Airport" autofocus required value="ATL">   
	<br>
	<label>To: </label>
	<input name="to" placeholder="To Airport" required value="SFO">
	<br>
	<label>Departure Date: </label>
	<input name="depDate" type="date" min="2011-01-01" max = "2012-12-31" required value="2012-11-29">
	<select name="depTime">
		<option value="anytime">anytime</option>
		<option value="morning">morning</option>
		<option value="noon">noon</option>
		<option value="evening">evening</option>
		<option value="late night">late night</option>
	</select>
	
	<br>
	<label>Return Date: </label>
	<input name="retDate" type="date" min="2011-01-01" max = "2012-12-31" required value="2012-12-15">
	<select name="retTime">
		<option value="anytime">anytime</option>
		<option value="morning">morning</option>
		<option value="noon">noon</option>
		<option value="evening">evening</option>
		<option value="late night">late night</option>
	</select>
	<br>
	<label>Number of Passengers: </label>
	<input name="numPassengers" type="number" min="1" max="10" value="1" required>
</fieldset>
<fieldset id="actions">
	<input type="submit" id="submit" value="Submit">
</fieldset>
</form>

<div id="flights"></div>


<script type="text/javascript">
var params = getUrlParameters();
if (params["from"]) {
	readForm(params);
}
</script>

</body>

</html>